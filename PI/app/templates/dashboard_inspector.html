{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">Inspector Dashboard</h2>
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title">Inspector Details</h5>
        <p class="card-text">Email: {{ current_user.email }}</p>
        <p class="card-text">Inspector ID: {{ current_user.inspector_id }}</p>
        <p class="card-text">Qualifications: {{ current_user.qualifications }}</p>
    </div>
</div>

<h3 class="mb-3">Registered Institutes</h3>
<div class="mb-3">
    <input type="text" id="searchInput" class="form-control" placeholder="Search institutes...">
</div>
<div id="instituteList">
    <!-- Institute list will be populated here -->
</div>

<script>
const searchInput = document.getElementById('searchInput');
const instituteList = document.getElementById('instituteList');

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function createInstituteCard(institute) {
    return `
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">${institute.name}</h5>
                <p class="card-text">Email: ${institute.email}</p>
                <p class="card-text">Gov. Verification Number: ${institute.gov_verification_number}</p>
                <p class="card-text">Phone: ${institute.phone}</p>
                <a href="/institute/${institute.id}" class="btn btn-primary">View Details</a>
            </div>
        </div>
    `;
}

function searchInstitutes() {
    const query = searchInput.value;
    fetch(`/search_institutes?query=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(institutes => {
            instituteList.innerHTML = institutes.map(createInstituteCard).join('');
        });
}

searchInput.addEventListener('input', debounce(searchInstitutes, 300));

// Initial load of all institutes
searchInstitutes();
</script>
{% endblock %}